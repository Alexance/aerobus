"use strict";function _typeof(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}!function(e,t){if("function"==typeof define&&define.amd)define(["module","exports"],t);else if("undefined"!=typeof exports)t(module,exports);else{var r={exports:{}};t(r,r.exports),e.aerobus=r.exports}}(this,function(e,t){function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function u(e){return Array.isArray(e)?e:Array.from(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(){return function(e){function t(e,r,i){return a(this,t),n(this,Object.getPrototypeOf(t).call(this,e,r,i))}return i(t,e),t}(Ue)}function c(){return function(e){function t(e,r,i){return a(this,t),n(this,Object.getPrototypeOf(t).call(this,e,r,i))}return i(t,e),t}(Xe)}function l(){return function(e){function t(e,r){return a(this,t),n(this,Object.getPrototypeOf(t).call(this,e,r))}return i(t,e),t}(qe)}function h(){return function(e){function t(e,r,i){return a(this,t),n(this,Object.getPrototypeOf(t).call(this,e,r,i))}return i(t,e),t}(ze)}function f(){function e(){for(var t=arguments.length,r=Array(t),n=0;t>n;n++)r[n]=arguments[n];return je(e).resolve(r)}function t(){var t=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];return je(e).bubble(t),e}function n(){return je(e).clear(),e}function i(){for(var e=g,t=arguments.length,r=Array(t),n=0;t>n;n++)r[n]=arguments[n];for(var i=-1,s=r.length;++i<s;){var u=r[i];switch(Z(u)){case T:e.bubbles=u;break;case P:e.error=u;break;case C:R(e,u);break;case I:if(!u.length)throw le(u);e.delimiter=u;break;default:throw ae(u)}}return f(e)}function s(){return je(e).bubbles}function u(){return Array.from(je(e).channels.values())}function a(){return je(e).delimiter}function o(){return je(e).error}function c(){return je(e).get("")}function l(){return je(e).trace}function h(t){if(!te(t))throw ke(t);je(e).trace=t}function v(){for(var t=arguments.length,r=Array(t),n=0;t>n;n++)r[n]=arguments[n];return je(e).unsubscribe(new Ne(r)),e}for(var b,g={bubbles:!0,channel:{},delimiter:".",error:function(e){throw e},message:{},pattern:{},section:{},trace:se,when:{}},y=arguments.length,p=Array(y),m=0;y>m;m++)p[m]=arguments[m];for(var w=-1,k=p.length;++w<k;){var x=p[w];switch(Z(x)){case T:g.bubbles=x;break;case P:g.error=x;break;case C:var O=x.bubbles,j=x.channel,E=x.delimiter,A=x.error,S=x.message,M=x.section,_=x.trace,N=x.when;if(Q(O)&&(g.bubbles=!!O),Q(E)){if(!ie(E)||!E.length)throw le(E);g.delimiter=E}if(Q(A)){if(!te(A))throw fe(A);g.error=A}if(Q(_)){if(!te(_))throw ke(_);g.trace=_}if(Q(j)){if(!ne(j))throw ce(j);R(g.channel,j)}if(Q(S)){if(!ne(S))throw de(S);R(g.message,S)}if(Q(M)){if(!ne(M))throw me(M);R(g.section,M)}if(Q(N)){if(!ne(N))throw xe(N);R(g.when,N)}break;case I:if(!x.length)throw le(x);g.delimiter=x;break;default:throw ae(x)}}return Ee(e,new Te(g)),B(e,(b={},r(b,W,{value:d}),r(b,"bubble",{value:t}),r(b,"bubbles",{get:s}),r(b,"clear",{value:n}),r(b,"create",{value:i}),r(b,"channels",{get:u}),r(b,"delimiter",{get:a}),r(b,"error",{get:o}),r(b,"root",{get:c}),r(b,"trace",{get:l,set:h}),r(b,"unsubscribe",{value:v}),b))}Object.defineProperty(t,"__esModule",{value:!0});var v,b=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),d="Aerobus",g=d+".Channel",y=d+".Forwarding",p=d+".Iterator",m=d+".Message",w=d+".Section",k=d+".Strategy.Cycle",x=d+".Strategy.Shuffle",O=d+".Subscriber",j=d+".Subscription",E=d+".Unsubscription",A=d+".When",S="Array",T="Boolean",P="Function",M="Number",_="RegExp",C="Object",I="String",W=Symbol.toStringTag,N=Symbol.iterator,F="prototype",R=Object.assign,D=Object.create,B=Object.defineProperties,G=Object.defineProperty,U=Object.getOwnPropertyDescriptor,X=Object.getOwnPropertyNames,q=Math.floor,z=Math.max,H=Math.min,J=Math.random,K=Number.MAX_SAFE_INTEGER,L=function(e){return null==e},Q=function(e){return null!=e},V=function(e,t){if(L(t))return e;for(var r=X(t),n=r.length-1;n>=0;n--){var i=r[n];i in e||G(e,i,U(t,i))}return e},Y=function(e,t){for(var r=e.length;r--;){try{e[r].done()}catch(n){setImmediate(function(){return t(n)})}e[r]=null}},Z=function(e){return Object.prototype.toString.call(e).slice(8,-1)},$=function(e){return function(t){return Z(t)===e}},ee=$(S),te=$(P),re=$(M),ne=$(C),ie=$(I),se=function(){},ue=function(){return!0},ae=function(e){return new TypeError('Argument of type "'+Z(e)+'" is not expected.')},oe=function(e){return new TypeError('Callback expected to be a function, not "'+Z(e)+'".')},ce=function(e){return new TypeError('Channel class extensions expected to be an object, not "'+e+'".')},le=function(e){return new TypeError('Delimiter expected to be not empty string, not "'+e+'".')},he=function(){return new TypeError("Dependency expected to be a channel name.")},fe=function(e){return new TypeError('Error expected to be a function, not "'+Z(e)+'".')},ve=function(){return new TypeError("Forwarder expected to be a function or a channel name.")},be=function(e){return new Error('This instance of "'+Z(e)+'"" has been deleted.')},de=function(e){return new TypeError('Message class extensions expected to be an object, not "'+e+'".')},ge=function(e){return new TypeError('Name expected to be a string, not "'+Z(e)+'".')},ye=function(e){return new TypeError('Order expected to be a number, not "'+Z(e)+'".')},pe=function(e){return new TypeError('Reference expected to be a regexp or a string, not "'+Z(e)+'".')},me=function(e){return new TypeError('Section class extensions expected to be an object, not "'+e+'".')},we=function(){return new TypeError('Subscriber expected to be a function or an object having "next" and optional "done" methods.')},ke=function(e){return new TypeError('Trace expected to be a function, not "'+Z(e)+'".')},xe=function(e){return new TypeError('When class extensions expected to be an object, not "'+e+'".')},Oe=new WeakMap,je=function(e){var t=Oe.get(e);if(L(t))throw be(e);return t},Ee=function(e,t){Q(t)?Oe.set(e,t):Oe["delete"](e,t)},Ae=function(){function e(){a(this,e),this.recordings=[]}return b(e,[{key:"bubble",value:function(e){this.recordings.push(["bubble",e])}},{key:"clear",value:function(){this.recordings.push(["clear"])}},{key:"enable",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];this.recordings.push(["enable",e])}},{key:"forward",value:function(e){this.recordings.push(["forward",e])}},{key:"publish",value:function(e,t){this.recordings.push(["publish",e,t])}},{key:"replay",value:function(e){for(var t=this.recordings,r=-1,n=t.length;++r<n;)for(var i=u(t[r]),a=i[0],o=i.slice(1),c=-1,l=e.length;++c<l;){var h;(h=je(e[c]))[a].apply(h,s(o))}}},{key:"reset",value:function(){this.recordings.push(["reset"])}},{key:"retain",value:function(e){this.recordings.push(["retain",e])}},{key:"subscribe",value:function(e){this.recordings.push(["subscribe",e])}},{key:"toggle",value:function(){this.recordings.push(["toggle"])}},{key:"unsubscribe",value:function(e){this.recordings.push(["unsubscribe",e])}}]),e}(),Se=function(){function e(t,r){var n=this;a(this,e),this.bus=t,this.dynamic=!1;for(var i=this.resolvers=[],s=function(e,s){var u=r[e];switch(Z(u)){case T:n.dynamic=u;break;case _:i.push(function(e){for(var r=Array.from(t.channels.values()),n=-1,i=r.length;++n<i;){var s=r[n];u.test(s.name)&&e.add(s)}});var a=n.predicate;a?n.predicate=function(e){return u.test(e.name)&&a(e)}:n.predicate=function(e){return u.test(e.name)};break;case I:i.push(function(e){return e.add(t.get(u))});break;default:throw pe(u)}},u=-1,o=r.length;++u<o;)s(u,o);this.dynamic&&(this.recording=new Ae)}return b(e,[{key:"notify",value:function(e){if(this.predicate&&this.predicate(e)){var t=this.recording;t&&t.replay(e)}}},{key:"record",value:function(e){this.replay&&e(this.replay)}},{key:"resolve",value:function(){if(this.resolved)return this.resolved;for(var e=new Set,t=this.resolvers,r=-1,n=t.length;++r<n;)t[r](e);return e=Array.from(e.values()),this.dynamic||(this.resolved=e),e}}]),e}(),Te=function(){function e(t){a(this,e),this.bubbles=t.bubbles,this.channels=new Map,this.delimiter=t.delimiter,this.error=t.error,this.id=0,this.resolvers=[],this.trace=t.trace,this.Channel=o(),V(this.Channel[F],t.channel),this.Message=c(),V(this.Message[F],t.message),this.Section=l(),V(this.Section[F],t.section),this.When=h(),V(this.When[F],t.when)}return b(e,[{key:"bubble",value:function(e){e=!!e,this.trace("bubble",e),this.bubbles=e}},{key:"clear",value:function(){var e=this.channels,t=!0,r=!1,n=void 0;try{for(var i,s=e.values()[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var u=i.value;Ee(u.clear(),null)}}catch(a){r=!0,n=a}finally{try{!t&&s["return"]&&s["return"]()}finally{if(r)throw n}}e.clear(),this.resolvers=[]}},{key:"create",value:function(e,t){var r=this.Channel,n=new r(this,e,t),i=this.resolvers;this.channels.set(e,n);for(var s=-1,u=i.length;++s<u;)i[s].notify(n);return n}},{key:"get",value:function(e){var t=this.channels,r=t.get(e);if(r)return r;if(""===e)return this.create(e);var n=t.get(""),i=this.delimiter,s=e.split(this.delimiter);e="",n||(n=this.create(e));for(var u=-1,a=s.length;++u<a;)e=e?e+i+s[u]:s[u],r=t.get(e),r||(r=this.create(e,n)),n=r;return r}},{key:"resolve",value:function(e){switch(e.length){case 0:return this.get("");case 1:var t=e[0];if(Z(t)===I)return this.get(t)}var r=this.Section,n=new Se(this,e);return n.dynamic&&this.resolvers.push(n),new r(this,n)}},{key:"unsubscribe",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,s=this.channels.values()[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var u=i.value;je(u).unsubscribe(e)}}catch(a){r=!0,n=a}finally{try{!t&&s["return"]&&s["return"]()}finally{if(r)throw n}}}}]),e}(),Pe=function(){function e(t,r,n,i){a(this,e),this.bubbles=t.bubbles,this.bus=t,this.enabled=!0,this.name=r,n&&(this.parent=je(n)),this.trace=i,i("create")}return b(e,[{key:"bubble",value:function(e){e=!!e,this.trace("bubble",e),this.bubbles=e}},{key:"clear",value:function(){this.trace("clear");var e=this.bus.error,t=this.observers,r=this.retentions,n=this.subscribers;r&&(r.length=0),t&&(Y(t,e),delete this.observers),n&&(Y(n,e),delete this.subscribers)}},{key:"cycle",value:function(e){this.trace("cycle",e.limit,e.step),e?this.strategy=e:delete this.strategy}},{key:"enable",value:function(e){e=!!e,this.trace("enable",e),this.enabled=e}},{key:"forward",value:function(e){var t=this.forwarders,r=e.forwarders;this.trace("forward",r),t?t.push.apply(t,s(r)):this.forwarders=r.slice()}},{key:"observe",value:function(e){var t=this.observers;this.observers=t?t.concat(e):[e]}},{key:"publish",value:function(e,t){var r=this;if(this.trace("publish",e),this.isEnabled){var n=this.bus.Message,i=this.observers,s=!1;if(e=Z(e)===m?new n(e.data,e.id,[this.name].concat(e.route)):new n(e,++this.bus.id,[this.name]),i)for(var u=-1,a=i.length;++u<a;){var o=i[u];o&&o.next(e)}if(!e.route.includes(this.name,1)){var c=this.forwarders;if(c){var l=new Set;s=!0;for(var u=-1,a=c.length;++u<a;){var h=c[u],f=te(h)?h(e.data,e):h;if(ee(f))for(var v=-1,b=f.length;++v<b;){var d=f[v];if(L(d)||this.name===d)s=!1;else{if(!ie(d))throw ge(d);l.add(d)}}else if(L(f)||this.name===f)s=!1;else{if(!ie(f))throw ge(f);l.add(f)}}var g=!0,y=!1,p=void 0;try{for(var w,k=l[Symbol.iterator]();!(g=(w=k.next()).done);g=!0){var x=w.value,O=je(this.bus.get(x)).publish(e,t);if(O===e.cancel)return O}}catch(j){y=!0,p=j}finally{try{!g&&k["return"]&&k["return"]()}finally{if(y)throw p}}}}if(!s){var E=this.retentions;if(E&&(E.push(e),E.length>E.limit&&E.shift()),this.bubbles){var A=this.parent;if(A){var O=A.publish(e,t);if(O===e.cancel)return O}}var S=this.subscribers;if(S){var T=this.strategy;T&&(S=T.select(S));for(var u=-1,a=S.length;++u<a;){var P=S[u];if(P)try{var O=P.next(e.data,e);if(O===e.cancel)return O;t(O)}catch(M){t(M),setImmediate(function(){return r.bus.error(M,e)})}}}}}}},{key:"reset",value:function(){this.trace("reset");var e=this.bus.error,t=this.observers,r=this.subscribers;this.enabled=!0,delete this.forwarders,delete this.observers,delete this.plans,delete this.retentions,delete this.strategy,delete this.subscribers,delete this.subscriptions,t&&Y(t,e),r&&Y(r,e)}},{key:"retain",value:function(e){if(e=re(e)?z(e,0):e?K:0,this.trace("retain",e),e){var t=this.retentions;t?(t.length>e&&(t=this.retentions=t.slice(t.length-e)),t.limit=e):(this.retentions=[],this.retentions.limit=e)}else delete this.retentions}},{key:"shuffle",value:function(e){this.trace("shuffle",e.limit),e?this.strategy=e:delete this.strategy}},{key:"subscribe",value:function(e){var t=this;this.trace("subscribe",e.parameters);var r=this.subscribers,n=this.retentions,i=e.subscribers;if(r)for(var s=-1,u=i.length;++s<u;){var a=i[s],o=r.length-1;if(r[o].order<=a.order)r.push(a);else{for(;o>0&&r[o]>a.order;)o--;r.splice(o,0,a)}}else this.subscribers=i.slice();if(n)for(var s=-1,u=i.length;++s<u;)for(var a=i[s],c=function(e,r){var i=n[e];try{a.next(i.data,i)}catch(s){setImmediate(function(){return t.bus.error(s,i)})}},l=-1,h=n.length;++l<h;)c(l,h)}},{key:"toggle",value:function(){this.trace("toggle"),this.enabled=!this.enabled}},{key:"unobserve",value:function(e){var t=this.observers,r=[];if(t)for(var n=t.length;--n;){var i=t[n];e===i?t[n]=null:r.push(e)}r.length?this.observers=r:delete this.observers}},{key:"unsubscribe",value:function(e){var t=this;this.trace("unsubscribe",e.parameters);var r=this.subscribers,n=e.predicates;if(r)if(n.length){for(var i=0,s=r.length;s--;){var u=r[s];if(u)for(var a=n.length;a--;)if(n[a](u)){r[s]=null,i++;try{u.done()}catch(o){setImmediate(function(){return t.bus.error(o)})}break}}if(i<r.length){for(var c=[],s=r.length;s--;){var u=r[s];u&&c.push(u)}this.subscribers=c}else delete this.subscribers}else{for(var s=r.length;s--;)try{r[s].done()}catch(o){setImmediate(function(){return t.bus.error(o)})}delete this.subscribers}}},{key:"isEnabled",get:function(){var e=this.parent;return this.enabled&&(!e||e.isEnabled)}}]),e}(),Me=function He(e){a(this,He);for(var t=[],r=-1,n=e.length;++r<n;){var i=e[r];switch(Z(i)){case y:t.push.apply(t,s(i.forwarders));break;case P:case I:t.push(i);break;default:throw ae(i)}}if(!t.length)throw ve();G(this,"forwarders",{value:t})};G(Me[F],W,{value:y});var _e=function(){function e(t){var r=this;a(this,e),this.disposed=!1,this.messages=[],this.rejects=[],this.resolves=[];var n=0,i={done:function(){++n<t.length||(r.disposed=!0,r.rejects.forEach(function(e){return e()}))},next:function(e){r.resolves.length?r.resolves.shift()(e):r.messages.push(e)}};this.disposer=function(){for(var e=t.length;e--;)je(t[e]).unobserve(i)};for(var s=t.length;s--;)je(t[s]).observe(i)}return b(e,[{key:"done",value:function(){if(!this.disposed){this.disposed=!0;for(var e=this.rejects,t=e.length;t--;)e[t]();this.disposer()}}},{key:"next",value:function(){var e=this;return this.disposed?{done:!0}:this.messages.length?{value:Promise.resolve(this.messages.shift())}:{value:new Promise(function(t,r){e.rejects.push(r),e.resolves.push(t)})}}}]),e}(),Ce=function(){function e(t,r){a(this,e),this.bus=t,this.resolver=r}return b(e,[{key:"bubble",value:function(e){this.each(function(t){return t.bubble(e)})}},{key:"clear",value:function(){this.each(function(e){return e.clear()})}},{key:"cycle",value:function(e){this.each(function(t){return t.cycle(e)})}},{key:"each",value:function(e){for(var t=this.resolver,r=t.resolve(),n=-1,i=r.length;++n<i;)e(je(r[n]));t.record(e)}},{key:"enable",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];this.each(function(t){return t.enable(e)})}},{key:"forward",value:function(e){this.each(function(t){return t.forward(e)})}},{key:"publish",value:function(e,t){this.each(function(r){return r.publish(e,t)})}},{key:"reset",value:function(){this.each(function(e){return e.reset()})}},{key:"retain",value:function(e){this.each(function(t){return t.retain(e)})}},{key:"shuffle",value:function(e){this.each(function(t){return t.shuffle(e)})}},{key:"subscribe",value:function(e){this.each(function(t){return t.subscribe(e)})}},{key:"toggle",value:function(){this.each(function(e){return e.toggle()})}},{key:"unsubscribe",value:function(e){this.each(function(t){return t.unsubscribe(e)})}}]),e}(),Ie=function Je(e,t,r){a(this,Je);var n=void 0,i=void 0;if(te(e))n=se,i=e;else if(Z(e)===O)n=e.done,i=e.next,L(t)&&(t=e.name),L(r)&&(r=e.order);else{if(!ne(e)||!te(e.next))throw we(e);if(i=function(t,r){return e.next(t,r)},Q(e.done)){if(!te(e.done))throw we(e);!function(){var t=!1;n=function(){t||(t=!0,e.done())}}()}else n=se;if(L(t)&&Q(e.name)){if(!ie(e.name))throw ge(e.name);t=e.name}if(L(r)&&Q(e.order)){if(!re(e.order))throw ye(e.order);r=e.order}}L(r)&&(r=0),B(this,{base:{value:e},done:{value:n},next:{value:i},order:{value:r}}),Q(t)&&G(this,"name",{value:t})};G(Ie[F],W,{value:O});var We=function Ke(e){a(this,Ke);for(var t=[],r=void 0,n=void 0,i=function(i,s){var u=e[i];switch(Z(u)){case P:case C:case O:t.push(function(){return new Ie(u,r,n)});break;case M:n=u;break;case I:r=u;break;default:throw ae(u)}},s=-1,u=e.length;++s<u;)i(s,u);if(!t.length)throw we();B(this,{parameters:{value:e},subscribers:{value:t.map(function(e){return e()})}})};G(We[F],W,{value:j});var Ne=function Le(e){a(this,Le);for(var t=[],r=function(r,n){var i=e[r];switch(Z(i)){case O:t.push(function(e){return e===i});break;case P:case C:t.push(function(e){return e.base===i});break;case I:t.push(function(e){return e.name===i});break;default:throw ae(i)}},n=-1,i=e.length;++n<i;)r(n,i);B(this,{parameters:{value:e},predicates:{value:t}})};G(Ne[F],W,{value:E});var Fe=function(e){function t(e,r,i){a(this,t);var s=n(this,Object.getPrototypeOf(t).call(this));s.condition=ue,s.sources=[],s.targets=i;for(var u=-1,o=r.length;++u<o;){var c=r[u];switch(Z(c)){case P:s.condition=c;break;case I:s.sources.push(c);break;default:throw ae(c)}}switch(s.sources.length){case 0:throw he();case 1:s.observer={done:se,next:function(e){s.condition(e)&&s.replay(s.targets)}},(s.sources[0]=je(e.get(s.sources[0]))).observe(s.observer);break;default:s.counters=new Map,s.observer={done:se,next:function(e){if(s.condition(e)){var t=e.destination,r=s.counters.get(t)+1;s.counters.set(t,r);for(var n=-1,i=s.counters.length;++n<i;)if(s.counters[n]!==r)return;s.replay(s.targets)}}};for(var u=s.sources.length-1;u>=0;u--)(s.sources[u]=je(e.get(s.sources[u]))).observe(s.observer)}return s}return i(t,e),b(t,[{key:"done",value:function(){for(var e=this.dependencies.length;e--;)this.dependencies[e].unobserve(this.observer)}}]),t}(Ae),Re=function(){function e(t,r){a(this,e),B(this,{cursor:{value:0,writable:!0},limit:{value:t},name:{value:"cycle"},step:{value:r}})}return b(e,[{key:"select",value:function(e){var t=e.length;if(!t)return[];for(var r=H(this.limit,t),n=this.cursor,i=Array(r);r-- >0;)i.push(e[n++%t]);return this.cursor+=this.step,i}}],[{key:"create",value:function(t,r){return(t=re(t)?t>0?t:0:t?1:0)?(r=re(r)&&r>0?r:t,new e(t,r)):null}}]),e}();G(Re[F],W,{value:k});var De=function(){function e(t){a(this,e),B(this,{limit:{value:t},name:{value:"shuffle"}})}return b(e,[{key:"select",value:function(e){var t=e.length;if(!t)return[];var r=H(this.limit,t),n=Array(r);do{var i=e[q(J()*t)];n.includes(i)||(n[--r]=i)}while(r>0);return n}}],[{key:"create",value:function(t){return t=re(t)?t>0?t:0:t?1:0,t?new e(t):null}}]),e}();G(De[F],W,{value:x});var Be=function(){function e(){a(this,e)}return b(e,[{key:"bubble",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];return je(this).bubble(e),this}},{key:"clear",value:function(){return je(this).clear(),this}},{key:"cycle",value:function(){var e=arguments.length<=0||void 0===arguments[0]?1:arguments[0],t=arguments[1];return je(this).cycle(Re.create(e,t)),this}},{key:"enable",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];return je(this).enable(e),this}},{key:"forward",value:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return je(this).forward(new Me(t)),this}},{key:"publish",value:function(e,t){var r=this;return Q(t)?!function(){if(!te(t))throw oe(t);var n=[];je(r).publish(e,function(e){return n.push(e)}),t(n)}():je(this).publish(e,se),this}},{key:"reset",value:function(){return je(this).reset(),this}},{key:"retain",value:function(){var e=arguments.length<=0||void 0===arguments[0]?K:arguments[0];return je(this).retain(e),this}},{key:"shuffle",value:function(){var e=arguments.length<=0||void 0===arguments[0]?1:arguments[0];return je(this).shuffle(De.create(e)),this}},{key:"subscribe",value:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return je(this).subscribe(new We(t)),this}},{key:"toggle",value:function(){return je(this).toggle(),this}},{key:"unsubscribe",value:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return je(this).unsubscribe(new Ne(t)),this}}]),e}(),Ge=function(){function e(t){a(this,e),Ee(this,new _e(t))}return b(e,[{key:"done",value:function(){je(this).done()}},{key:"next",value:function(){return je(this).next()}}]),e}();G(Ge[F],W,{value:p});var Ue=function(e){function t(e,r,i){a(this,t);var s=n(this,Object.getPrototypeOf(t).call(this));G(s,"name",{value:r,enumerable:!0}),Q(i)&&G(s,"parent",{value:i,enumerable:!0});var u=function(t){for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;r>i;i++)n[i-1]=arguments[i];return e.trace.apply(e,[t,s].concat(n))};return Ee(s,new Pe(e,r,i,u)),s}return i(t,e),b(t,[{key:"when",value:function(e){var t=je(this),r=t.bus,n=r.When;return new n(r,e,[this])}},{key:N,value:function(){return new Ge([this])}},{key:"bubbles",get:function(){return je(this).bubbles}},{key:"enabled",get:function(){return je(this).isEnabled}},{key:"forwarders",get:function(){var e=je(this),t=e.forwarders;return t?t.slice():[]}},{key:"retentions",get:function(){var e=je(this).retentions,t=[];return e?(t.push.apply(t,s(e)),t.limit=e.limit):t.limit=0,t}},{key:"strategy",get:function(){return je(this).strategy}},{key:"subscribers",get:function(){var e=je(this),t=e.subscribers;return t?t.filter(Q):[]}}]),t}(Be);G(Ue[F],W,{value:g});var Xe=function Qe(e,t,r){a(this,Qe),B(this,{data:{value:e,enumerable:!0},destination:{value:r[0],enumerable:!0},id:{value:t,enumerable:!0},route:{value:r,enumerable:!0}})};B(Xe[F],(v={},r(v,W,{value:m}),r(v,"cancel",{value:D(null)}),v));var qe=function(e){function t(e,r){a(this,t);var i=n(this,Object.getPrototypeOf(t).call(this));return Ee(i,new Ce(e,r)),i}return i(t,e),b(t,[{key:"when",value:function(e){var t=je(this),r=t.bus,n=r.When;return new n(r,e,t.channels)}},{key:N,value:function(){return new Ge(je(this).resolver.resolve())}},{key:"channels",get:function(){return[].concat(s(je(this).resolver.resolve()))}}]),t}(Be);G(qe[F],W,{value:w});var ze=function(e){function t(e,r,i){a(this,t);var s=n(this,Object.getPrototypeOf(t).call(this));return Ee(s,new Fe(e,r,i)),s}return i(t,e),b(t,[{key:"done",value:function(){return je(this).done(),this}},{key:N,value:function(){return new Ge(je(this).targets)}},{key:"condition",get:function(){return je(this).condition}},{key:"sources",get:function(){return[].concat(s(je(this).sources))}},{key:"targets",get:function(){return[].concat(s(je(this).targets))}}]),t}(Be);G(ze[F],W,{value:A}),t["default"]=f,e.exports=t["default"]});