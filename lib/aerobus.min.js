"use strict";function _typeof(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}!function(e,t){if("function"==typeof define&&define.amd)define(["module","exports"],t);else if("undefined"!=typeof exports)t(module,exports);else{var n={exports:{}};t(n,n.exports),e.aerobus=n.exports}}(this,function(e,t){function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(){return function(e){function t(e,r,i){return o(this,t),n(this,Object.getPrototypeOf(t).call(this,e,r,i))}return r(t,e),t}(ue)}function s(){return function(e){function t(){var e;o(this,t);for(var r=arguments.length,i=Array(r),u=0;r>u;u++)i[u]=arguments[u];return n(this,(e=Object.getPrototypeOf(t)).call.apply(e,[this].concat(i)))}return r(t,e),t}(oe)}function c(){return function(e){function t(e,r){return o(this,t),n(this,Object.getPrototypeOf(t).call(this,e,r))}return r(t,e),t}(ae)}function l(){function e(){for(var t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];switch(n.length){case 0:return S(y);case 1:return S(n[0]);default:return new j(e,n.map(function(e){return S(e)}))}}function t(){var t=!0,n=!1,r=void 0;try{for(var i,u=x.values()[Symbol.iterator]();!(t=(i=u.next()).done);t=!0){var o=i.value;o.clear()}}catch(a){n=!0,r=a}finally{try{!t&&u["return"]&&u["return"]()}finally{if(n)throw r}}return x.clear(),A.isSealed=!1,e}function n(){return Array.from(x.values())}function r(){return A.delimiter}function i(e){A.isSealed&&re(g),ee(e)&&0!==e.length||re(v),A.delimiter=e}function u(){return S(b)}function o(){return S(y)}function f(){return A.trace}function p(e){A.isSealed&&re(g),W(e)||re(k),A.trace=e}function d(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(E,[null].concat(t)))}function S(t){var n=x.get(t);if(!n){var r=void 0;if(t!==y&&t!==b){ee(t)||re(m);var i=t.indexOf(A.delimiter);r=S(-1===i?y:t.substr(0,i))}n=new w(e,t,r),A.isSealed=!0,x.set(t,n)}return n}function O(){var t=!0,n=!1,r=void 0;try{for(var i,u=x.values()[Symbol.iterator]();!(t=(i=u.next()).done);t=!0){var o=i.value;o.unsubscribe.apply(o,arguments)}}catch(a){n=!0,r=a}finally{try{!t&&u["return"]&&u["return"]()}finally{if(n)throw r}}return e}for(var w=a(),E=s(),j=c(),x=new Map,A={delimiter:h,isSealed:!1,trace:te},M=arguments.length,N=Array(M),C=0;M>C;C++)N[C]=arguments[C];return N.forEach(function(e){switch(V(e)){case P:A.trace=e;break;case _:ne(w.prototype,e.channel),ne(E.prototype,e.message),ne(j.prototype,e.section);break;case T:0===e.length&&re(v),A.delimiter=e}}),Object.defineProperties(e,{clear:{value:t},create:{value:l},channels:{get:n},delimiter:{get:r,set:i},error:{get:u},message:{value:d},root:{get:o},trace:{get:f,set:p},unsubscribe:{value:O}})}Object.defineProperty(t,"__esModule",{value:!0});var f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h=".",b="error",y="",p="Callback expected to be a function.",v="Delimiter expected to be not empty string.",g="This operation is forbidden for not empty bus instance.",m="Name expected to be string.",d="Subscription expected to be a function.",k="Trace expected to be a function.",S="Aerobus",O=S+h+"Channel",w=S+h+"Iterator",E=S+h+"Message",j=S+h+"Section",x="Error",P="Function",A="Number",_="Object",T="String",M=Symbol.toStringTag,N=Symbol.iterator,C=Symbol("channel"),F=Symbol("bus"),D=Symbol("channels"),I=Symbol("data"),R=Symbol("done"),G=Symbol("enabled"),X=Symbol("error"),q=Symbol("messages"),z=Symbol("name"),B=Symbol("parent"),H=Symbol("retentions"),J=Symbol("resolvers"),K=Symbol("rejectors"),L=Symbol("subscription"),Q=Symbol("subscriptions"),U=Number.MAX_SAFE_INTEGER,V=Object.classof,W=function(e){return V(e)===P},Y=function(e){return null==e},Z=function(e){return V(e)===A},$=function(e){return null!=e},ee=function(e){return V(e)===T},te=function(){},ne=function(e,t){return Y(t)?e:Object.getOwnPropertyNames(t).reduce(function(e,n){return e.hasOwnProperty(n)?e:Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))},e)},re=function(e){throw new Error(e)},ie=function(){function e(t){var n,r=this;o(this,e);var i=function(e,t){var n=r[J];n.length?n.shift()(t):r[q].push(t)};Object.defineProperties(this,(n={},u(n,M,{value:w}),u(n,R,{value:!1,writable:!0}),u(n,q,{value:[]}),u(n,B,{value:t}),u(n,K,{value:[]}),u(n,J,{value:[]}),u(n,L,{value:i}),n)),t.subscribe(i)}return f(e,[{key:"done",value:function(){this[R]||(this[R]=!0,this[B].unsubscribe(this[L]),this[K].forEach(function(e){return e()}))}},{key:"next",value:function(){var e=this;if(this[R])return{done:!0};var t=this[q],n=t.length?Promise.resolve(t.shift()):new Promise(function(t,n){e[K].push(n),e[J].push(t)});return{value:n}}}]),e}(),ue=function(){function e(t,n,r){var i;o(this,e);var a=[];a.limit=0,a.period=0,Object.defineProperties(this,(i={},u(i,F,{value:t}),u(i,M,{value:O}),u(i,G,{value:!0,writable:!0}),u(i,z,{value:n,enumerable:!0}),u(i,B,{value:r}),u(i,H,{value:a}),u(i,Q,{value:[]}),i)),t.trace("create",this)}return f(e,[{key:"clear",value:function(){return this[F].trace("clear",this),this[G]=!0,this[H].length=this[Q].length=0,this}},{key:"disable",value:function(){return this[G]&&(this[F].trace("disable",this),this[G]=!1),this}},{key:"enable",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];return e?(this[G]||(this[F].trace("enable",this),this[G]=!0),this):this.disable()}},{key:"publish",value:function(e,t){if($(t)&&!W(t)&&re(p),this.isEnabled){var n=this[F],r=n.message(this,e),u=this[Q],o=this[H];if(o.limit>0&&(o.push(r),o.length>o.limit&&o.shift()),this[z]===b)return t?!function(){var e=[];u.forEach(function(t){return e.push(t(r.error,r))}),t(e)}():u.forEach(function(e){return e(r.error,r)}),this;var a=this[B];return t?!function(){var e=[];a&&a.publish(r,function(t){return e.push.apply(e,i(t))}),u.forEach(function(t){try{e.push(t(r.data,r))}catch(i){e.push(i),n.error.publish(n.message(r,i),function(e){return i.results=e})}}),t(e)}():(a&&a.publish(r),u.forEach(function(e){try{e(r.data,r)}catch(t){n.error.publish(n.message(r,t))}})),this}}},{key:"retain",value:function(e){var t=this[H];return t.limit=arguments.length?Z(e)?Math.max(e,0):e?U:0:U,t.length>t.limit&&t.splice(0,t.length-t.limit),this[F].trace("retain",this),this}},{key:"subscribe",value:function(){for(var e,t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];return n.every(W)||re(d),(e=this[Q]).push.apply(e,n),this[H].forEach(function(e){return n.forEach(function(t){return t(e.data,e)})}),this}},{key:"toggle",value:function(){return this[G]?this.disable():this.enable(),this}},{key:"unsubscribe",value:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];return n.length?!function(){var t=e[Q];n.forEach(function(e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)})}():this[Q].length=0,this}},{key:N,value:function(){return new ie(this)}},{key:"bus",get:function(){return this[F]}},{key:"isEnabled",get:function(){return this[G]&&(!this[B]||this[B].isEnabled)}},{key:"name",get:function(){return this[z]}},{key:"parent",get:function(){return this[B]}},{key:"retentions",get:function(){var e=this[H],t=[].concat(i(e));return t.limit=e.limit,t}},{key:"root",get:function(){return this[F].root}},{key:"subscriptions",get:function(){return[].concat(i(this[Q]))}}]),e}(),oe=function(){function e(){var t;o(this,e);for(var n=void 0,r=void 0,i=void 0,a=arguments.length,s=Array(a),c=0;a>c;c++)s[c]=arguments[c];s.forEach(function(e){switch(V(e)){case O:Y(n)&&(n=e[z]);break;case E:Y(n)&&(n=e[C]),Y(r)&&(r=e[I]),Y(i)&&(i=e[X]);break;case x:Y(i)&&(i=e);break;default:Y(r)&&(r=e)}}),Object.defineProperties(this,(t={},u(t,C,{value:n,enumerable:!0}),u(t,M,{value:E}),u(t,I,{value:r,enumerable:!0}),t)),$(i)&&Object.defineProperty(this,X,{value:i,enumerable:!0})}return f(e,[{key:"channel",get:function(){return this[C]}},{key:"data",get:function(){return this[I]}},{key:"error",get:function(){return this[X]}}]),e}(),ae=function(){function e(t,n){o(this,e),this[F]=t,this[M]=j,this[D]=n}return f(e,[{key:"clear",value:function(){return this[D].forEach(function(e){return e.clear()}),this}},{key:"disable",value:function(){return this[D].forEach(function(e){return e.disable()}),this}},{key:"enable",value:function(e){return this[D].forEach(function(t){return t.enable(e)}),this}},{key:"publish",value:function(e,t){return this[D].forEach(function(n){return n.publish(e,t)}),this}},{key:"subscribe",value:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return this[D].forEach(function(e){return e.subscribe.apply(e,t)}),this}},{key:"toggle",value:function(){return this[D].forEach(function(e){return e.toggle()}),this}},{key:"unsubscribe",value:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return this[D].forEach(function(e){return e.unsubscribe.apply(e,t)}),this}},{key:N,value:function(){return new ie(this)}},{key:"bus",get:function(){return this[F]}},{key:"channels",get:function(){return[].concat(i(this[D]))}}]),e}();t["default"]=l,e.exports=t["default"]});