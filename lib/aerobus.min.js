"use strict";function _typeof(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}!function(e,t){if("function"==typeof define&&define.amd)define(["module","exports"],t);else if("undefined"!=typeof exports)t(module,exports);else{var r={exports:{}};t(r,r.exports),e.aerobus=r.exports}}(this,function(e,t){function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(){return function(e){function t(e,n,i){return o(this,t),r(this,Object.getPrototypeOf(t).call(this,e,n,i))}return n(t,e),t}(ue)}function s(){return function(e){function t(){var e;o(this,t);for(var n=arguments.length,i=Array(n),u=0;n>u;u++)i[u]=arguments[u];return r(this,(e=Object.getPrototypeOf(t)).call.apply(e,[this].concat(i)))}return n(t,e),t}(oe)}function c(){return function(e){function t(e,n){return o(this,t),r(this,Object.getPrototypeOf(t).call(this,e,n))}return n(t,e),t}(ae)}function l(){function e(){for(var t=arguments.length,r=Array(t),n=0;t>n;n++)r[n]=arguments[n];switch(r.length){case 0:return S(y);case 1:return S(r[0]);default:return new j(e,r.map(function(e){return S(e)}))}}function t(){var t=!0,r=!1,n=void 0;try{for(var i,u=P.values()[Symbol.iterator]();!(t=(i=u.next()).done);t=!0){var o=i.value;o.clear()}}catch(a){r=!0,n=a}finally{try{!t&&u["return"]&&u["return"]()}finally{if(r)throw n}}return P.clear(),A.isSealed=!1,e}function r(){return Array.from(P.values())}function n(){return A.delimiter}function i(e){A.isSealed&&ne(g),ee(e)&&0!==e.length||ne(p),A.delimiter=e}function u(){return S(b)}function o(){return S(y)}function f(){return A.trace}function v(e){A.isSealed&&ne(g),W(e)||ne(k),A.trace=e}function d(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return new(Function.prototype.bind.apply(w,[null].concat(t)))}function S(t){var r=P.get(t);if(!r){var n=void 0;if(t!==y&&t!==b){ee(t)||ne(m);var i=t.indexOf(A.delimiter);n=S(-1===i?y:t.substr(0,i))}r=new E(e,t,n),A.isSealed=!0,P.set(t,r)}return r}function O(){var t=!0,r=!1,n=void 0;try{for(var i,u=P.values()[Symbol.iterator]();!(t=(i=u.next()).done);t=!0){var o=i.value;o.unsubscribe.apply(o,arguments)}}catch(a){r=!0,n=a}finally{try{!t&&u["return"]&&u["return"]()}finally{if(r)throw n}}return e}for(var E=a(),w=s(),j=c(),P=new Map,A={delimiter:h,isSealed:!1,trace:te},M=arguments.length,N=Array(M),C=0;M>C;C++)N[C]=arguments[C];return N.forEach(function(e){switch(V(e)){case x:A.trace=e;break;case _:re(E.prototype,e.channel),re(w.prototype,e.message),re(j.prototype,e.section);break;case T:0===e.length&&ne(p),A.delimiter=e}}),Object.defineProperties(e,{clear:{value:t},create:{value:l},channels:{get:r},delimiter:{get:n,set:i},error:{get:u},message:{value:d},root:{get:o},trace:{get:f,set:v},unsubscribe:{value:O}})}Object.defineProperty(t,"__esModule",{value:!0});var f=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),h=".",b="error",y="",v="Callback expected to be a function.",p="Delimiter expected to be not empty string.",g="This operation is forbidden for not empty bus instance.",m="Name expected to be string.",d="Subscription expected to be a function.",k="Trace expected to be a function.",S="Aerobus",O=S+h+"Channel",E=S+h+"Iterator",w=S+h+"Message",j=S+h+"Section",P="Error",x="Function",A="Number",_="Object",T="String",M=Symbol.toStringTag,N=Symbol.iterator,C=Symbol("channel"),F=Symbol("bus"),D=Symbol("channels"),I=Symbol("data"),R=Symbol("done"),G=Symbol("enabled"),X=Symbol("error"),q=Symbol("messages"),z=Symbol("name"),B=Symbol("parent"),H=Symbol("retentions"),J=Symbol("resolvers"),K=Symbol("rejectors"),L=Symbol("subscription"),Q=Symbol("subscriptions"),U=Number.MAX_SAFE_INTEGER,V=Object.classof,W=function(e){return V(e)===x},Y=function(e){return null==e},Z=function(e){return V(e)===A},$=function(e){return null!=e},ee=function(e){return V(e)===T},te=function(){},re=function(e,t){return Y(t)?e:Object.getOwnPropertyNames(t).reduce(function(e,r){return e.hasOwnProperty(r)?e:Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))},e)},ne=function(e){throw new Error(e)},ie=function(){function e(t){var r,n=this;o(this,e);var i=function(e,t){var r=n[J];r.length?r.shift()(t):n[q].push(t)};Object.defineProperties(this,(r={},u(r,M,{value:E}),u(r,R,{value:!1,writable:!0}),u(r,q,{value:[]}),u(r,B,{value:t}),u(r,K,{value:[]}),u(r,J,{value:[]}),u(r,L,{value:i}),r)),t.subscribe(i)}return f(e,[{key:"done",value:function(){this[R]||(this[R]=!0,this[B].unsubscribe(this[L]),this[K].forEach(function(e){return e()}))}},{key:"next",value:function(){var e=this;if(this[R])return{done:!0};var t=this[q],r=t.length?Promise.resolve(t.shift()):new Promise(function(t,r){e[K].push(r),e[J].push(t)});return{value:r}}}]),e}(),ue=function(){function e(t,r,n){var i;o(this,e);var a=[];a.limit=0,a.period=0,Object.defineProperties(this,(i={},u(i,F,{value:t}),u(i,M,{value:O}),u(i,G,{value:!0,writable:!0}),u(i,z,{value:r}),u(i,B,{value:n}),u(i,H,{value:a}),u(i,Q,{value:[]}),i)),t.trace("create",this)}return f(e,[{key:"clear",value:function(){return this[F].trace("clear",this),this[H].length=this[Q].length=0,this}},{key:"disable",value:function(){return this[G]&&(this[F].trace("disable",this),this[G]=!1),this}},{key:"enable",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];return e?(this[G]||(this[F].trace("enable",this),this[G]=!0),this):this.disable()}},{key:"publish",value:function(e,t){if($(t)&&!W(t)&&ne(v),this.isEnabled){var r=this[F],n=r.message(this,e),u=this[Q],o=this[H];if(o.limit>0&&(o.push(n),o.length>o.limit&&o.shift()),this[z]===b)return t?!function(){var e=[];u.forEach(function(t){return e.push(t(n.error,n))}),t(e)}():u.forEach(function(e){return e(n.error,n)}),this;var a=this[B];return t?!function(){var e=[];a&&a.publish(n,function(t){return e.push.apply(e,i(t))}),u.forEach(function(t){try{e.push(t(n.data,n))}catch(i){e.push(i),r.error.publish(r.message(n,i),function(e){return i.results=e})}}),t(e)}():(a&&a.publish(n),u.forEach(function(e){try{e(n.data,n)}catch(t){r.error.publish(r.message(n,t))}})),this}}},{key:"retain",value:function(e){var t=this[H];return t.limit=arguments.length?Z(e)?Math.max(e,0):e?U:0:U,t.length>t.limit&&t.splice(0,t.length-t.limit),this[F].trace("retain",this),this}},{key:"reset",value:function(){return this[F].trace("reset",this),this.clear(),this[G]=!0,this[H].limit=0,this}},{key:"subscribe",value:function(){for(var e,t=arguments.length,r=Array(t),n=0;t>n;n++)r[n]=arguments[n];return r.every(W)||ne(d),(e=this[Q]).push.apply(e,r),this[H].forEach(function(e){return r.forEach(function(t){return t(e.data,e)})}),this}},{key:"toggle",value:function(){return this[G]?this.disable():this.enable(),this}},{key:"unsubscribe",value:function(){for(var e=this,t=arguments.length,r=Array(t),n=0;t>n;n++)r[n]=arguments[n];return r.length?!function(){var t=e[Q];r.forEach(function(e){var r=t.indexOf(e);-1!==r&&t.splice(r,1)})}():this[Q].length=0,this}},{key:N,value:function(){return new ie(this)}},{key:"bus",get:function(){return this[F]}},{key:"isEnabled",get:function(){return this[G]&&(!this[B]||this[B].isEnabled)}},{key:"name",get:function(){return this[z]}},{key:"parent",get:function(){return this[B]}},{key:"retentions",get:function(){var e=this[H],t=[].concat(i(e));return t.limit=e.limit,t}},{key:"subscriptions",get:function(){return[].concat(i(this[Q]))}}]),e}(),oe=function(){function e(){var t;o(this,e);for(var r=void 0,n=void 0,i=void 0,a=arguments.length,s=Array(a),c=0;a>c;c++)s[c]=arguments[c];s.forEach(function(e){switch(V(e)){case O:Y(r)&&(r=e[z]);break;case w:Y(r)&&(r=e[C]),Y(n)&&(n=e[I]),Y(i)&&(i=e[X]);break;case P:Y(i)&&(i=e);break;default:Y(n)&&(n=e)}}),Object.defineProperties(this,(t={},u(t,C,{value:r,enumerable:!0}),u(t,M,{value:w}),u(t,I,{value:n,enumerable:!0}),t)),$(i)&&Object.defineProperty(this,X,{value:i,enumerable:!0})}return f(e,[{key:"channel",get:function(){return this[C]}},{key:"data",get:function(){return this[I]}},{key:"error",get:function(){return this[X]}}]),e}(),ae=function(){function e(t,r){var n;o(this,e),Object.defineProperties(this,(n={},u(n,F,{value:t}),u(n,M,{value:j}),u(n,D,{value:r}),n))}return f(e,[{key:"clear",value:function(){return this[D].forEach(function(e){return e.clear()}),this}},{key:"disable",value:function(){return this[D].forEach(function(e){return e.disable()}),this}},{key:"enable",value:function(e){return this[D].forEach(function(t){return t.enable(e)}),this}},{key:"publish",value:function(e,t){return this[D].forEach(function(r){return r.publish(e,t)}),this}},{key:"reset",value:function(){return this[D].forEach(function(e){return e.reset()}),this}},{key:"subscribe",value:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return this[D].forEach(function(e){return e.subscribe.apply(e,t)}),this}},{key:"toggle",value:function(){return this[D].forEach(function(e){return e.toggle()}),this}},{key:"unsubscribe",value:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return this[D].forEach(function(e){return e.unsubscribe.apply(e,t)}),this}},{key:N,value:function(){return new ie(this)}},{key:"bus",get:function(){return this[F]}},{key:"channels",get:function(){return[].concat(i(this[D]))}}]),e}();t["default"]=l,e.exports=t["default"]});